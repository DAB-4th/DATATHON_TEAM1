<hr/>

# FA 선수의 성과 기반 시장 가치 예측 모델링
<img src="https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54"/>
<img src="https://img.shields.io/badge/jupyter-%23F37626.svg?&style=for-the-badge&logo=jupyter&logoColor=white"/>

<p align='center'>
<img src="https://upload.wikimedia.org/wikipedia/ko/thumb/7/79/Korea_Baseball_Organization_-_2022_logo_with_wordmark_horizontal.svg/1024px-Korea_Baseball_Organization_-_2022_logo_with_wordmark_horizontal.svg.png" height="123" width="342">
</p>
<hr/>

## 목차
- [개요](https://github.com/DAB-4th/DATATHON_TEAM1?tab=readme-ov-file#%EA%B0%9C%EC%9A%94)
- [프로젝트 설명](https://github.com/DAB-4th/DATATHON_TEAM1?tab=readme-ov-file#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%84%A4%EB%AA%85)
- [가설](https://github.com/DAB-4th/DATATHON_TEAM1?tab=readme-ov-file#%EA%B0%80%EC%84%A4
)
- [딥러닝 및 머신러닝](https://github.com/DAB-4th/DATATHON_TEAM1?tab=readme-ov-file#%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D-%EB%B0%8F-%EB%94%A5%EB%9F%AC%EB%8B%9D)
- [기대 효과](https://github.com/DAB-4th/DATATHON_TEAM1?tab=readme-ov-file#%EA%B8%B0%EB%8C%80-%ED%9A%A8%EA%B3%BC)
- [프로젝트 기여도](https://github.com/DAB-4th/DATATHON_TEAM1?tab=readme-ov-file#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B8%B0%EC%97%AC%EB%8F%84)
<hr/>

## 개요
- 프로젝트 이름 : FA 선수의 성과 기반 시장 가치 예측 모델링
- 프로젝트 지속 기간 : 2025.04.09 ~ 2025.05.13
- 개발 엔진 및 언어 : Python (with Colab & Jupyter Notebook)
- 멤버 : 팀 퍼펙트게임 (강상민, 신은서, 이선엽, 이정태, 표룡희)

<hr/>

## 프로젝트 설명

### FA 선수의 성과 기반 시장 가치 예측 모델링

성과 대비 과대/과소평가된 사례 분석을 통해 **FA 시장의 비효율성**을 진단하며, 리그 전체의 자원 배분 효율성을 높이기 위한 데이터 기반의 의사결정을 도출하여, FA 전 성과를 기반으로 해당 선수의 **시장 가치(계약금) 예측 모델을 개발**하려는 목적을 가지고 있습니다.

### 사용 데이터
  [KBO](https://www.koreabaseball.com) 및 [STATIZ](https://statiz.sporki.com/)의 데이터를 사용하였으며, 데이터는 2009~2024년 사이의 FA 승인 선수에 대한 데이터를 사용하였습니다.

<hr/>

### 사용 기술
- Language : Python 3.11+
- Library
  - `pandas`, `numpy`, `scikit-learn`,
  - `matplotlib`, `seaborn`
  - `xgboost`, `lihgtbgm`, `shap`
<hr/>

### 전처리

1. 결측치 <br>
  ① 제거 파트
    - 군 복무의 경우 선수 개인이 제어할 수 있는 영역이 아니라고 판단하였습니다.
    - 누락의 경우 KBO/스탯티즈의 원본 데이터 자체의 누락이었습니다. <br>
       → 대안이 존재하지 않았습니다.<br>
 ② 제거하지 않은 파트
    - 부상 / 1군 미등록은 선수의 역량으로 판단하였습니다.
 2. 이상치 판단 <br>

    Q3 + 1.5 * IQR을 크기 초과하는 이상치가 존재하였습니다.
    - 투수의 세이브
    - 타자의 홈런
    - 이외 지표
    다만, 이는 그 선수의 역량이 좋아 생겨난 결과로 추정해, 비합리적인 이상치로 보기 어렵다는 판단.<br>
     → 이상치를 제거하지 않았습니다.
<hr/>

## 가설 

### 1. 센터라인 포지션(SS, 2B, C, CF)에 있는 선수들이 비슷한 성적을 낸 다른 포지션의 선수들보다 더 높은 연평균 금액을 보장받을 것이다.
- 분석 방법
  - 4년 누적 WAR에 따라 구간을 구분
    - 상위 25%, 25~75%, 하위 25%
- 분석 결과
  - 통계적으로 유의미하지 않음
    - 어느 성적 구간에서도 유격수가 3루수를 앞서지 못했음
    - 어느 성적 구간에서도 중견수가 우익수를 앞서지 못했음
    - 성적 구간의 구분이 없는 전체 분포의 경우, 수비기여가 없는 지명타자(DH)가 **포수를 제외한 센터라인보다** 연 평균 계약이 높음
  - 각 구단이 수비가 중요한 포지션인 센터라인보다 타격이 중요한 좌익수, 우익수, 3루수에 더 큰 투자를 하고 있는 것으로 보임
    <br> → KBO 시장은 타격에 더 큰 가치를 부여하고 있는 것으로 보임

### 2. 이적한 선수들이 잔류한 선수들에 비해 유의미하게 높은 FA 총액을 쟁취했을 것이다.
- 분석 방법
  - 이적 선수와 잔류 선수의 FA 총액을 비교
- 분석 결과
  - 통계적으로 유의미함
  - 이상치에 해당하는 국가대표 레벨 선수들의 잔류 건수를 제외하면, **포지션을 막론하고 이적한 FA 선수들이 잔류한 FA 선수보다 현저히 높은 계약 총액 수준을 보인다**

### 3. 구원 투수(일명 불펜)은 다른 포지션에 비해 FA 가격이 낮을 것이다.
- 분석 방법
  - 불펜 투수 내에서도 세부 포지션으로 나누어 평균 FA 금액 구분
  - 불펜 투수 그룹과 그 이외의 그룹을 나누어 그룹별 FA 금액 평균을 제시
- 분석 결과
  - ANOVA 검정 시행 결과 통계적으로 유의미함.
  - FA까지 가게 된 **중간 계투**의 경우 자주 등판하여 많은 이닝을 소화해, 몸의 부하가 많아, **FA 이후 부상 위험이 크기 때문에, FA 금액이 낮은 것으로 추정**
  - 다만 **마무리 투수**의 경우, 고정적인 이닝에 등판하는 경우가 많아, **관리의 측면에서 매우 원활하므로**, FA 금액이 증가한다.

### <s>4. FA 시즌을 맞이한 선수들은 팀의 성적보다는 개인 성적에 더 집중한다.</s>
- 만약 팀과 개인 성적을 비교하려면, 레버리지 인덱스(avLI)를 확인해야하는데, 이는 선수 한 명 한 명 의 시즌 및 날짜마다 레버리지 인덱스를 확인해야하여, 이를 구체적으로 확인하려면, 각 타자의 타석당 레버리지 인덱스를 추출해와야하는데, FA 선수의 경우 4년치만 잡아도, **한 선수당, 96경기(타자의 FA 자격 조건 경기 수)  X 4타석 x 4년 = 최소 1,536타석 이기에** 시간 상 데이터 수집하기 쉽지 않다. 

### 5. (FA를 이미 한 번 치른 경험이 있는 선수의 경우) 이번 FA 금액이 지난 FA 금액보다 낮을 시 (분발하기 위해) 성적이 좋아진다.
- 분석 방법
  - WAR, oWAR(공격 WAR), dWAR(수비 WAR) 활용
  - 두 FA 계약 간의 총액 차이와 성적 지표인 WAR 변화량 비교
  - FA 계약 총액 차이 = 두 번째 FA 금액 - 첫 번째 FA 금액
  - WAR 차이 = 두 번째 FA WAR - 첫 번째 FA WAR
- 분석 결과
  - 야수 채택 / 투수 기각
  - 대부분 선수는 돈을 덜 받게 되었지만, 드물게 더 많이 받은 선수들이 더 좋은 성적 향상을 보여서, 전체적인 FA 금액 증가
    → WAR 증가의 경향이 나옴
  - 현재 보유한 데이터의 수가 충분치 않아, 해당 가설을 통계적으로 유의미하게 검증하기에는 한계가 있다고 생각하여 판단 기각

### 6. FA 직전 시즌의 WAR이 5 이상인 경우, 계약금은 급격히 증가한다.
- 분석 방법
  - WAR 분포를 가지고, 적정한 WAR를 찾음
- 분석 결과
  - T-검정 결과 통계적으로 유의미함.
  - 실질적으로 금액 격차가 높아지는 구간은 WAR > 3
  - 오히려 WAR > 7인 경우, 통계적으로 유의미하지 않는다.
    <br>→ 그 정도의 선수가 없기 때문에 표본 수가 부족할 것으로 추정

### <s>7. FA를 앞둔 선수들이 성적에 비해 과한 욕심을 부린다.</s>
- 과한 욕심에 대한 정의가 어려워 가설 자체를 검증하지 않음.

### <s>8. FA 계약으로 이적한 선수는 잔류한 선수보다 유의미하게 높은 연평균 연봉을 받았을 것이다.</s>
- <b>*가설 2번과 통합하였음*</b>
- [가설 2번](https://github.com/DAB-4th/DATATHON_TEAM1/blob/main/README.md#2-%EC%9D%B4%EC%A0%81%ED%95%9C-%EC%84%A0%EC%88%98%EB%93%A4%EC%9D%B4-%EC%9E%94%EB%A5%98%ED%95%9C-%EC%84%A0%EC%88%98%EB%93%A4%EC%97%90-%EB%B9%84%ED%95%B4-%EC%9C%A0%EC%9D%98%EB%AF%B8%ED%95%98%EA%B2%8C-%EB%86%92%EC%9D%80-fa-%EC%B4%9D%EC%95%A1%EC%9D%84-%EC%9F%81%EC%B7%A8%ED%96%88%EC%9D%84-%EA%B2%83%EC%9D%B4%EB%8B%A4)
  
### 9. FA선수가 되어 연봉이 오른 선수의 경우 차기 년도 성적이 좋을 것이다.
- 분석 방법
  - 성적 판단 지표를 설정 후, 상관관계 분석
  - 투수 : ERA, FIP, 종합 WAR
  - 야수 : 종합 WAR
- 분석 결과
  - 상관관계 분석 및 검정 결과 유의미하지 않음.
  - FA 금액이 오른 선수의 경우 성적을 제외한 여러 복합 요인이 있었을 것
    <br> → 이로 인하여 FA 가격이 예상보다 오르게 될 것
  - 또한, 각 해 별로 컨디션에 따라, 성적이 달라질 가능성이 농후하다. (부상으로 인한 시즌 아웃 등)

### 10. 플레이년도 팀 성적이 좋은 구단일수록 (5등 이상) 이적률이 높으며, 이는 선수의 개인 성적보다 더 강한 영향을 미친다.
- 분석 방법
  - 이적 전 성적 / 이적 후 팀 전 해 성적 비교 해, 상위권인지 하위권인지 판별 후, 이적 분류를 함
- 분석 결과
  - 카이제곱 검정 결과 통계적으로 유의미하지 않음.
    
### 11. 교타자보다 중장거리형 타자 혹은 거포형 타자가 FA 금액을 더 많이 받을 것이다.

- 분석 방법
  - 타자 유형을 스탯 4개를 기준으로 나누어 분류 후, FA 금액 평균 측정
  - 교타자와 중장거리/거포 타자를 묶어 두 그룹으로 평균 금액 측정

- 분석 결과
    - T 검정 시행 결과 통계적으로 유의미함
    - 교타자의 경우, 출루가 좋지만, **득점 생산 효율성 면에서는 장타가 가치 있기 때문에** 중장거리/거포형 타자가 더 많은 금액을 받게 된다.

## 머신러닝 및 딥러닝
- 연도별 가중치를 두어, 다양한 모델을 적용해, 에측력이 높은 가중치 조합을 발굴
- FA 직전 4년 중, 군 복무를 한 선수들의 플레이년도에 대해서 가중치를 할당해, 손실을 보상함.
- 부상이나 부진 선수는 선수 평가에 대해서 마이너스적인 요소로 처리.
   - 선수의 자기관리에 따라 어느 정도 예방이 가능한 것임.
   - 기타 요인(군 복무 등)으로 1년을 날린 것은 가중치를 0으로 적용
- 연도는 분류 모델로 전환해 예측.
   - 단위가 커, 소수점으로 나오는 에측치가 충분히 합리적인 FA 액수와 달리, 연도는 근본적으로 1.4년, 2.7년 등과 같은 소수점 단위가 나올 수 없는 구조이다.
   - 총액에 비해, 연도의 예측력이 매우 불안정하기 때문에, 이산적 데이터인 연도를 아예 분류 모델의 대상으로 취급해, 예측력을 높임.
- 사용 모델
   - xgboost
   - RandomForest
   - keras(Adam, RMSprop)

- 모델링 추진 요약
   - xgboost : 초기에 선택한 부스팅 모델
   - RandomForest : 적은 데이터의 한계를 보완하기 위해 배깅 기법을 사용하는 모델로 성능 개선
   - keras : 레이어로 많은 연산을 수행해 연수와 총액 사이의 상관관계까지 반영하는 모델로 균형 있는 예측력 구현
   - KBO의 룰로 인해 적중률 한계가 있는 연수보다 총액을 맞히는 것이 모델에 더 중요해 keras 모델이 목표 달성에 가장 근접
   - 적은 샘플이라는 조건으로 인해 RandomForest도 전반적으로 상당히 높은 예측력을 발휘

- 모델링 추진 결과
   - 선수의 나이, 누적 성적, 포지션 등 경기 내외의 몇 요소만으로 실제 계약 금액을 근접하게 예측하는 것이 가능
   - 모델이 객관적인 요소를 기반으로 예측한 시장 가치보다 실제 계약 금액이 월등히 큰 선수가 대부분 올해 부진함
   - 선수를 영입할 때 객관적이며 핵심적인 요소 몇 가지를 위주로 선수 가치를 평가하는 것이 영입 실패를 줄일 수 있음
   - 대부분의 모델에서 이적 여부가 몸값을 높이는 강력한 요인으로 작용해 구단의 자체 육성 능력이 중요함을 암시
   - 부상 이력 등 구단이 확보 가능한 중요 정보를 더 넣어 평가한다면 리스크를 잘 반영한 미래 가치 평가가 가능할 것

<hr/>

## 기대 효과
- 성과 기반 계약 모델의 실효성 확인
- FA 제도의 투명성 확보 기여
- 야구 산업 내 데이터 기반 의사결정 도입 사례 제시

<hr/>

## 프로젝트 기여도
|이름|역할|
|-----|-----|
|강상민|데이터 분석, 모델링, 인사이트 도출|
|신은서|데이터 분석, 데이터 시각화, 플로우 정리|
|이선엽|데이터 수집 및 분석, 데이터 시각화|
|이정태|데이터 분석 및 인사이트 도출|
|표룡희|데이터 수집 및 분석, 인사이트 도출|
